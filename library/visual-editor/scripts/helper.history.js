define(["jquery","modules/iframe","deps/mousetrap"],function($,iframe,mousetrap){var Chronology=function(settings){this.settings={limit:20,call:true};this.set(settings);this.clear();};Chronology.prototype.set=function(settings){for(var s in settings){this.settings[s]=settings[s];}return this;};Chronology.prototype.add=function(occurence){this.redos=[];if(!occurence instanceof Chronology.Occurence){occurence=new Chronology.Occurence(occurence);}this.undos.unshift(occurence);if(occurence.call===true||(typeof occurence.call=="undefined"&&this.settings.call===true)){occurence.up();}if(this.settings.limit){this.undos.splice(this.settings.limit);}if(typeof this.settings.onAdd=="function"){this.settings.onAdd(occurence);}panelOptions();return this;};Chronology.prototype.clear=function(){this.redos=[];this.undos=[];if(typeof this.settings.onClear=="function"){this.settings.onClear();}return this;};Chronology.prototype.revert=function(){var occurence;while(occurence=this.undos.shift()){occurence.down();}return this.clear();};Chronology.prototype.undo=function(){var occurence;if(occurence=this.undos.shift()){this.redos.unshift(occurence);occurence.down();if(typeof this.settings.onUndo=="function"){this.settings.onUndo(occurence);}if(this.undos.length==0&&typeof this.settings.onBegin=="function"){this.settings.onBegin(occurence);}}return this;};Chronology.prototype.redo=function(){var occurence;if(occurence=this.redos.shift()){this.undos.unshift(occurence);occurence.up();if(typeof this.settings.onRedo=="function"){this.settings.onRedo(occurence);}if(this.redos.length==0&&typeof this.settings.onEnd=="function"){this.settings.onEnd(occurence);}}return this;};Chronology.Occurence=function(states){states=states||{};this.up=states.up||function(){};this.down=states.down||function(){};};var panelOptions=function(){if(UpFront.history.redos.length>0){$(".history-wrapper button.redo").addClass("active");}else{$(".history-wrapper button.redo").removeClass("active");}if(UpFront.history.undos.length>0){$(".history-wrapper button.undo").addClass("active");}else{$(".history-wrapper button.undo").removeClass("active");}$(document).on("click",".history-wrapper button.undo",function(){UpFront.history.undo();panelOptions();});$(document).on("click",".history-wrapper button.redo",function(){UpFront.history.redo();panelOptions();});};var history={init:function(){UpFront.history=new Chronology({limit:0});history.bind();},bind:function(){mousetrap.bind(["ctrl+z","command+z"],function(event){UpFront.history.undo();panelOptions();return false;});mousetrap.bind(["ctrl+y","command+y"],function(event){UpFront.history.redo();panelOptions();return false;});}};return history;});