setupContextMenu=function(args){if(typeof args!="object"){return false;}var args=$.extend(true,{},{isIframeElement:true},args);deactivateContextMenu(args.id);var contextMenuOpenEvent=!UpFront.touch?"contextmenu.contextMenu"+args.id:"taphold.contextMenu"+args.id;if(args.isIframeElement){$iDocument().on(contextMenuOpenEvent,args.elements,function(event,eventArgs){event.data=eventArgs;contextMenuCreator(args,event,true);});}else{$(document).on(contextMenuOpenEvent,args.elements,function(event,eventArgs){event.data=eventArgs;contextMenuCreator(args,event,false);});}var clickToClose=function(event){if((event.which!==0&&event.which!==1)||$(event.originalEvent.target).parents("#context-menu-"+args.id).length){return;}var contextMenu=$("#context-menu-"+args.id);if(typeof args.onHide=="function"){args.onHide.apply(contextMenu);}contextMenu.remove();};var contextMenuCloseEvent=!UpFront.touch?"click":"touchstart";$("body").on(contextMenuCloseEvent+".contextMenu"+args.id,clickToClose);$i("body").on(contextMenuCloseEvent+".contextMenu"+args.id,clickToClose);};deactivateContextMenu=function(id){$(document).off(".contextMenu"+id);$iDocument().off(".contextMenu"+id);$("body").off(".contextMenu"+id);$i("body").off(".contextMenu"+id);return true;};contextMenuCreator=function(args,event,iframe){event.stopPropagation();if(typeof args!="object"){return false;}$(".context-menu").remove();var contextMenuTitle=typeof args.title=="function"?args.title.apply(undefined,[event]):args.title;var contextMenu=$('<ul id="context-menu-'+args.id+'" class="context-menu"><h3>'+contextMenuTitle+"</h3></ul>");if(typeof args.onShow=="function"){args.onShow.apply(contextMenu,[event]);}args.contentsCallback.apply(contextMenu,[event]);var originalRightClickEvent=event;var contextMenuItemClick=function(event){if(typeof args.onItemClick=="function"){args.onItemClick.apply(this,[contextMenu,originalRightClickEvent]);}if(typeof args.onHide=="function"){args.onHide.apply(contextMenu);}contextMenu.remove();};var contextMenuClickEvent=!UpFront.touch?"click":"touchstart";contextMenu.delegate("span",contextMenuClickEvent,contextMenuItemClick);if(typeof event.originalEvent!="undefined"&&typeof event.originalEvent.clientX!="undefined"){var contextMenuX=event.originalEvent.clientX;var contextMenuY=event.originalEvent.clientY+40;if($("body").hasClass("panel-on-left")){contextMenuX+=290;}}else{var contextMenuX;var contextMenuY;if(event.type=="taphold"){var contextMenuX=event.originalEvent.touches[0].clientX;var contextMenuY=event.originalEvent.touches[0].clientY+40;}else{var contextMenuX=event.data.x;var contextMenuY=event.data.y+40;}}if(!$("#customize-preview").hasClass("preview-desktop")){contextMenuX+=jQuery("iframe#content").offset().left;}contextMenu.css({left:contextMenuX,top:contextMenuY});contextMenu.delegate("li:has(ul) span","hover",function(){var childMenu=$(this).siblings("ul");var childMenuOffset=childMenu.offset();if(!childMenuOffset||((childMenu.offset().left+childMenu.outerWidth())<$("iframe.content").width())){return;}childMenu.css("right",childMenu.css("left"));childMenu.css("left","auto");childMenu.css("width","190px");childMenu.css("zIndex","999999");});contextMenu.appendTo($("body"));if((contextMenuX+contextMenu.outerWidth())>$(window).width()){var overflow=$(window).width()-(contextMenuX+contextMenu.outerWidth());contextMenu.css("left",contextMenuX+overflow-20);}if((contextMenuY+contextMenu.outerHeight())>$(window).height()){var overflow=$(window).height()-(contextMenuY+contextMenu.outerHeight());contextMenu.css("top",contextMenuY+overflow-20);}if(event.cancelable){event.preventDefault();}return false;};